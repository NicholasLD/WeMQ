# 基于SSM的物联网调试管理平台

[![mqttlogo.png](https://img.nicholasld.cn/i/2023/04/08/6430b2aff1b11.png)](https://img.nicholasld.cn/i/2023/04/08/6430b2aff1b11.png)

## 1. 项目介绍

### 1.1 项目简介

**MQTT调试管理平台是一款基于Spring + Spring MVC + Mybatis开发的一款物联网设备调试管理平台。**

其功能主要是对客户MQTT调试页面进行集中管理（连接信息、发送信息），系统管理员可在后台添加客户和调试页面，并设置调试页面的连接信息、发送消息和对应的发送按钮文字，并设置分享链接以及页面的开启状态，用户可通过分享链接打开配置好对应信息的页面，实现对自己设备的管理调试。

### 1.2 技术选型

##### 1. 系统环境

- Java 11
- Servlet 3.0
- Apache Maven 3

##### 2. 主框架

- Spring Framework 5.3.x
- Spring MVC 5.3.x

##### 3. 持久层

- Mybatis 3.5.x
- Alibaba Druid 1.2.x
- Hibernate Validation 6.0.x
- Java MySQL Connector 8.0.x

##### 4. 视图层

- Thymeleaf 3.x
- Bootstrap 5.x

##### 5. 工具类

- Apache Commons
- Hutool 5.x

### 1.3 主要功能

- 系统管理员管理
- 客户管理
- 调试页面管理
- 对接Nmqs（NicholasLD's Message Queue Service）
- 客户调试页面
- 登录日志

### 1.4 项目负责人

**组长：**

李任任、龙政宇

**组员：**

罗猷力、常浩哲、纪雨佳、李宇航、梁晓惠、袁祎阳

## 2. MQTT介绍 

### 2.1 什么是MQTT？

​		[MQTT](https://mqtt.org/) 是一种基于发布/订阅模式的轻量级消息传输协议，专门针对低带宽和不稳定网络环境的物联网应用而设计，可以用极少的代码为联网设备提供实时可靠的消息服务。MQTT 协议广泛应用于物联网、移动互联网、智能硬件、车联网、智慧城市、远程医疗、电力、石油与能源等领域。

MQTT 协议由 [Andy Stanford-Clark](http://en.wikipedia.org/wiki/Andy_Stanford-Clark) （IBM）和 Arlen Nipper（Arcom，现为 Cirrus Link）于 1999 年发布。 按照 Nipper 的介绍，MQTT 必须具备以下几点：

- 简单容易实现
- 支持 QoS（设备网络环境复杂）
- 轻量且省带宽（因为那时候带宽很贵）
- 数据无关（不关心 Payload 数据格式）
- 有持续地会话感知能力（时刻知道设备是否在线）

据 Arlen Nipper 在 [IBM Podcast 上的自述](https://www.ibm.com/podcasts/software/websphere/connectivity/piper_diaz_nipper_mq_tt_11182011.pdf)，MQTT 原名是 `MQ TT`，注意 `MQ` 与 `TT`之间的空格，其全称为: MQ Telemetry Transport，是九十年代早期他在参与 Conoco Phillips 公司的一个原油管道数据采集监控系统（pipeline SCADA system）时开发的一个实时数据传输协议。它的目的在于让传感器通过带宽有限的 [VSAT](https://en.wikipedia.org/wiki/Very-small-aperture_terminal) ，与 IBM 的 MQ Integrator 通信。由于 Nipper 是遥感和数据采集监控专业出身，所以按业内惯例取了 `MQ TT` 这个名字。

### 2.2 它在本项目中可以做什么？

本项目主要围绕 以HTML制作的MQTT调试页面 进行集中管理和发布，客户通过管理员分配的分享链接，进入到属于自己的页面，通过页面客户端连接MQTT服务器，进行对物联网设备的调试。

## 3. 具体开发

### 开发过程

```
1. （已完成）登录日志 Mapper接口、XML实现（龙政宇）
2. （已完成）调试参数 Mapper接口、XML实现（梁晓惠、袁祎阳、纪雨佳）
3. 管理员 Mapper接口、XML实现（李任任）
4. 客户 Mapper接口、XML实现（罗猷力、常浩哲、李宇航）
5. （已完成）调试页面 Mapper接口、XML实现（龙政宇）
6. （已完成）NMQS Token Mapper接口、XML实现（龙政宇）
7. （已完成）NMQS Token Service业务层（龙政宇）
8. 客户 Service业务层（罗猷力、常浩哲、李宇航）
9. 管理员 Service业务层（李任任）
10. 调试参数 Service业务层（梁晓惠、袁祎阳、纪雨佳）
11. 调试页面 Service业务层（龙政宇）
12. ViewController 
13. 客户 Controller层
14. 管理员 Controller层
15. NMQS Token Controller层
16. 调试页面 Controller层
```



### 项目准备

建立项目MQTT-Manager，并添加不同模块

```
cn.mmanager
├── mm-common            // 工具类
│       └── annotation                    // 自定义注解
│       └── constant                      // 通用常量
│       └── core                          // 核心控制
│       └── enums                         // 通用枚举
│       └── exception                     // 通用异常
├── mm-framework         // 框架核心
│       └── aspectj                       // 注解实现
│       └── interceptor                   // 拦截器
│       └── manager                       // 异步处理
│       └── web                           // 前端控制
├── mm-web       	 // Web服务
├── mm-dao      	 // 数据访问层
├── mm-service     // 业务层
├── mm-model       // 模型
```



### 3.1 管理员登录

#### 模块负责人

龙政宇

### 3.2 管理员主页

#### 模块负责人

龙政宇

### 3.3 管理员管理

#### 模块负责人

龙政宇、xxx

#### 实体

**Admin：**

| 备注     | 字段名      | 数据类型   |
|:-------|:---------|:-------|
| 管理员ID  | id       | Long   |
| 管理员用户名 | username | String |
| 管理员昵称  | nickname | String |
| 登录密码   | password | String |
| 启用状态   | status   | int    |

#### 具体功能

1. **API：根据条件查询管理员**
2. **API：删除管理员**
3. **API：增加管理员**
4. **API：修改管理员**
5. **Web：对接API（龙政宇）**

### 3.4 管理员登录日志

#### 模块负责人

龙政宇、xxx

#### 实体

**LoginLog：**

| 备注     | 字段名         | 数据类型      |
|--------|-------------|-----------|
| 日志ID   | id          | Long      |
| 管理员ID  | adminID     | Long      |
| 登录IP   | adminIP     | String    |
| 操作系统   | adminOS     | String    |
| 登录时间   | loginTime   | timestamp |
| 是否登录成功 | loginStatus | int       |

#### 具体功能

1. **API：根据条件查询日志**
2. **Service：添加日志记录**
3. **Web：对接API（龙政宇）**

### 3.5 调试页面管理

#### 模块负责人

龙政宇、

#### 实体

**MQPage：**

| 备注            | 字段名         | 数据类型          |
|---------------|-------------|---------------|
| 页面ID          | id          | Long          |
| 页面名称          | pageName    | String        |
| 访问URL         | pageUrl     | String        |
| Nmqs Token ID | nmqsTokenID | int           |
| 启用状态          | status      | int           |
| 调试参数          | mqParams    | List<MQParam> |

**MQParam：**

| 备注   | 字段名     | 数据类型   |
|------|---------|--------|
| 参数ID | id      | Long   |
| 消息内容 | message | String |
| 按钮名称 | button  | String |

#### 具体功能

1. **API：添加调试页面**
2. **API：修改调试页面**
3. **API：删除调试页面**
4. **API：根据条件查询调试页面**
5. **Web：对接API**

### 3.6 客户管理

#### 模块负责人

龙政宇、xxx

#### 实体

**Customer：**

| 备注   | 字段名     | 数据类型         |
|------|---------|--------------|
| 客户ID | id      | Long         |
| 客户名称 | name    | String       |
| 调试页面 | mqPages | List<MQpage> |

#### 具体功能：

1. **API：根据条件查询客户**
2. **API：添加客户**
3. **API：删除客户**
4. **API：修改客户**
5. **Web：对接API（龙政宇）**

### 3.7 Nmqs Token管理

#### 模块负责人

龙政宇

#### 实体：

**NmqsToken：**

| 备注      | 字段名              | 数据类型   |
|---------|------------------|--------|
| TokenID | id               | Long   |
| Token名称 | name             | String |
| Token   | token            | String |
| 服务器地址   | mqttServer       | String |
| 服务器端口   | mqttPort         | int    |
| 服务器用户名  | mqttUsername     | String |
| 服务器密码   | mqttPassword     | String |
| 发布订阅    | mqttSendTopic    | String |
| 接收订阅    | mqttReceiveTopic | String |
| Qos     | mqttQos          | int    |

#### 具体功能：

1. **API：添加Token**
2. **API：修改Token**
3. **API：删除Token**
4. **API：根据条件查询Token**
5. **Web：对接API**

### 3.8 调试页面

#### 模块负责人

龙政宇

### 3.9 调试日志管理

#### 模块负责人

龙政宇

## 4. 项目开发规范

### 4.1 Spring自动装配

在本项目中，Spring自动装配，需在属性的setter方法上使用@Autowired进行装配。

例：

```java
public class Customer {
	private Person person;
	
	@Autowired
	public void setPerson(Person person) {
		this.person = person;
	}
}
```

### 4.2 表单等数据提交需进行防重复提交处理

在需要进行提交操作的Controller中，添加 `@RepeatSubmit` 注解，进行防重复提交操作。

| 参数       | 类型     | 默认值           | 描述                   |
|----------|--------|---------------|----------------------|
| interval | int    | 5000          | 间隔时间(ms)，小于此时间视为重复提交 |
| message  | String | 不允许重复提交，请稍后再试 | 提示消息                 |

例：

```java
@RepeatSubmit(interval = 1000, message = "请勿重复提交")
@PostMapping("/testPOST")
@ResponseBody
public String test(String name) {
    return "success";
}
```

### 4.3 数据的获取均采用API方式

所有响应数据均采用API方式返回，返回统一格式JSON数据，以便前端对接。

添加 `@ResponseBody` 注解
